parameters:
  - name: artifactName
  - name: environmentName
  - name: globalTerraformVariableFilename
  - name: pathToTerraformDirectory
  - name: pathToTerraformEnvironmentVariablesDirectory 
  - name: serviceConnectionName
  - name: webAppProjectName

steps:
  - checkout: self
    persistCredentials: true
  - template: printEnv.yml
  - template: deployTerraform.yml
    parameters:
      environmentName: ${{ parameters.environmentName }}
      globalTerraformVariableFilename: ${{ parameters.globalTerraformVariableFilename }}
      pathToTerraformDirectory: ${{ parameters.pathToTerraformWebAppDirectory }}
      pathToTerraformEnvironmentVariablesDirectory: ${{ parameters.pathToTerraformEnvironmentVariablesDirectory }}
  - template: deployWebApp.yml
    parameters:
      appServiceName: $(terraformOutput.appServiceName) 
      artifactName: $(Pipeline.Workspace)/${{ parameters.artifactName }}/${{ parameters.webAppProjectName }}.zip
      serviceConnectionName: ${{ parameters.serviceConnectionName }}